<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
  <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="0">

  <title>Sp22Anno 管理后台</title>

  <link href="css/bootstrap_5.1.3_.min.css" rel="stylesheet">

  <link href="css/style.css" rel="stylesheet">

  <style type="text/css">
  </style>

</head>

<body>

  <div class="bodywrap" id="bodywrap">

    <div class="page-cover" v-if="false">
      <div class="container pt-5 text-center">
        <div class="row">
          <div><h2>空间关系理解数据标注 2022 后台</h2></div>
        </div>
        <div class="row">
          <div>
            <p>正在加载，请稍候……</p>
          </div>
        </div>
      </div>
    </div>

    <!-- navbar start -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="#">空间关系理解数据标注 2022 后台</a>
      </div>
    </nav>
    <!-- navbar end -->


    <div class="container page my-4">
      <div class="container py-2">
        <div class="row align-items-center">
          <div class="col col-12 col-md-3 col-lg-4 my-2">
            <div class="form-floating">
              <input
               class="form-control form-control-sm"
               type="text"
               v-model="ctrl.currentUser.name"
               placeholder="请输入您的姓名"
              >
              <label class="form-label">姓名</label>
            </div>
          </div>
          <div class="col col-12 col-md-9 col-lg-8 my-2">
            <div class="form-floating">
              <input
               class="form-control form-control-sm"
               type="password"
               v-model="ctrl.currentUser.token"
               placeholder="请输入您的密码"
              >
              <label class="form-label">密码</label>
            </div>
          </div>
        </div>
        <div class="row align-items-center my-2">
          <div class="col col-12">
            <button
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="{'btn-outline-secondary': theDB.users?.length, 'btn-outline-primary': !theDB.users?.length}"
              @click="()=>{sync()}"
              title="从服务器更新最新数据，仅更新 User, Task, Anno 表"
            >更新数据库</button>
            <button
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="{'btn-outline-secondary': theDB.entries?.length, 'btn-outline-primary': !theDB.entries?.length}"
              @click="()=>{modalBox.toggle()}"
              title="因网络传输不太稳定，而语料库较大，故请从本地选择语料库文件进行加载"
            >导入 语料(Entry) 表</button>
          </div>
        </div>
      </div>
    </div>

    <div class="container page my-4">
      <div class="container py-2">
        <div class="row">
          <div class="col">
            <ul class="nav nav-tabs">
              <li class="nav-item">
                <a class="nav-link" :class="ctrl.tab == TABS.overview ? 'active' : ''" href="#" @click="goTab('overview')">总体进度</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="ctrl.tab == TABS.entryAndTask ? 'active' : ''" href="#" @click="goTab('entryAndTask')">标注详情</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="ctrl.tab == TABS.userProgress ? 'active' : ''" href="#" @click="goTab('userProgress')">用户进度</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="ctrl.tab == TABS.userInfo ? 'active' : ''" href="#" @click="goTab('userInfo')">用户信息</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="row align-items-center my-2" v-show="ctrl.tab == TABS.userProgress">
          <div class="col col-12">
            <table class="table table-sm table-bordered table-striped table-hover">
              <thead class="text-center">
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">姓名</th>
                  <th scope="col">角色</th>
                  <th scope="col">小组</th>
                  <th scope="col">负责人</th>
                  <th scope="col">任务类型</th>
                  <th scope="col">此类进度</th>
                  <th scope="col">累计</th>
                  <th scope="col">操作</th>
                </tr>
              </thead>
              <tbody class="text-center">
                <tr v-for="user in theDB.users" :key="user.id" class="align-middle">
                  <td>{{user.id}}</td>
                  <td>{{user.name}}<span v-if="user.quited" class="badge rounded-pill bg-danger ms-2">已退出</span></td>
                  <td><span v-for="role in user.role" class="badge rounded-pill bg-primary me-1">{{role}}</span></td>
                  <td>{{user.currTaskGroup}}</td>
                  <td>{{user.manager}}</td>
                  <td>{{topic2using(user.currTask)}}</td>
                  <td>
                    <div class="progress" :class="{'bg-success bg-opacity-25': userProgress(user).done}" title="标注进度">
                      <div
                        class="progress-bar bg-success"
                        role="progressbar"
                        :style="`min-width: ${userProgress(user).pct};`"
                        :aria-valuenow="userProgress(user).mn"
                        :aria-valuemax="userProgress(user).bg"
                        aria-valuemin="0"
                      >{{ userCurrDoneTasks(user).length }}/{{ userCurrTasks(user).length }}</div>
                    </div>
                  </td>
                  <td>{{user.allAnnos?.length}}</td>
                  <td>
                    <button
                      type="button"
                      class="btn btn-sm me-2 my-1 btn-outline-secondary"
                      :title="`查看${user.name}所标注的具体情况`"
                    >查看详情</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="row align-items-center my-2" v-show="ctrl.tab == TABS.userInfo">
          <div class="col col-12">
            <table class="table table-sm table-bordered table-striped table-hover">
              <thead class="text-center">
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">姓名</th>
                  <th scope="col">角色</th>
                  <th scope="col">任务类型</th>
                  <th scope="col">小组</th>
                  <th scope="col">负责人</th>
                  <!-- <th scope="col">机构简称</th> -->
                  <th scope="col">机构</th>
                  <th scope="col">电话</th>
                  <th scope="col">邮箱</th>
                  <th scope="col">微信</th>
                  <th scope="col">其他</th>
                  <th scope="col">操作</th>
                </tr>
              </thead>
              <tbody class="text-center">
                <tr v-for="user in theDB.users" :key="user.id" class="align-middle">
                  <td>{{user.id}}</td>
                  <td>{{user.name}}<span v-if="user.quited" class="badge rounded-pill bg-danger ms-2">已退出</span></td>
                  <td><span v-for="role in user.role" class="badge rounded-pill bg-primary me-1">{{role}}</span></td>
                  <td>{{topic2using(user.currTask)}}</td>
                  <td>{{user.currTaskGroup}}</td>
                  <td>{{user.manager}}</td>
                  <!-- <td>{{user?.info?.inst_abbr}}</td> -->
                  <td>{{user?.info?.institution}}</td>
                  <td>{{user?.info?.phone}}</td>
                  <td>{{user?.info?.email}}</td>
                  <td>{{user?.info?.wechat}}</td>
                  <td>{{user?.info?.other}}</td>
                  <td>
                    <button
                      type="button"
                      class="btn btn-sm me-2 my-1 btn-outline-secondary btn-copy-token"
                      :title="`点击拷贝${user.name}的密码`"
                      :data-clipboard-text="`${user.name}的密码是： ${user.token}`"
                    >拷贝密码</button>
                    <button
                      type="button"
                      class="btn btn-sm me-2 my-1 btn-outline-secondary"
                      :title="`给${user.name}添加“已退出”标记`"
                    >标记退出</button>
                    <button
                      type="button"
                      class="btn btn-sm me-2 my-1 btn-outline-secondary"
                      :title="`对${user.name}的信息进行详细编辑`"
                    >编辑</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>



    <!-- Modal -->
    <div class="modal-wrap" style="display: block;" ref="modal_wrap">
      <div class="modal" v-show="modalBox.data.show" :class="{show: modalBox.data.show}">


        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" v-if="modalBox.data.theme = MODAL_THEMES.default">
          <div class="modal-content">
            <!-- <div class="modal-header">
              <h5 class="modal-title">Modal title</h5>
              <button type="button" class="btn-close"></button>
            </div> -->
            <div class="modal-body">
              <form class="row align-items-center my-2" name="file-form" id="filePicker">
                <div class="col-md-8 my-2">
                  <input
                    type="file"
                    class="form-control form-control-sm"
                    name="file-input"
                    id="file-input"
                    accept=".json, .txt"
                  />
                </div>
                <div class="btn-group btn-group-sm col-md-4 my-2">
                  <button
                    v-if="ctrl?.currentWorker?.length"
                    type="button"
                    name="do_import"
                    id="do_import"
                    @click="ioC.onImport(win.document)"
                    class="btn btn-primary"
                  >导入</button>
                  <button
                    v-if="!dfWrap?.dataItems?.length && ctrl.haveStore && ctrl?.currentWorker?.length"
                    type="button"
                    name="do_loadStore"
                    id="do_loadStore"
                    @click="ioC.loadStore()"
                    class="btn btn-success"
                  >加载缓存数据</button>
                  <button
                    :disabled="!dfWrap?.dataItems?.length"
                    type="button"
                    name="do_export"
                    id="do_export"
                    @click="ioC.onExport()"
                    class="btn btn-info"
                  >导出</button>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-sm btn-secondary" @click="()=>{modalBox.hide()}">Close</button>
            </div>
          </div>
        </div>


      </div>
    </div>


    <!-- Alert -->
    <div class="alert-wrap" style="display: block;" ref="alert_wrap">
      <transition name="fade" v-for="alert in alertBox.data.alerts">
        <div v-show="alert?.show" class="alert alert-dismissible" :class="'alert-'+(alert?.type ?? 'info')">
          <button type="button" class="btn-close" @click="alertBox.removeAlert(alert?.idx)"></button>
          <div>{{alert?.content}}</div>
        </div>
      </transition>
    </div>

  </div>
  <!-- bodywrap end -->

  <script type="module" src="js/manage.mjs.js"></script>
</body>

</html>
